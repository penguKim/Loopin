<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
				xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
				xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
				layout:decorate="~{layout}" 
				layout:fragment="content">
<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
<style>
/* #treeMapContainer에 스크롤은 가능하되 스크롤바는 보이지 않도록 */
#treeMapContainer {
    overflow: auto;
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE and Edge */
}
/* Chrome, Safari, Opera */
#treeMapContainer::-webkit-scrollbar {
    display: none;
}
</style>
<body>
	<main id="main" class="main">
		<section class="section">
			<div class="row">
				<div class="col-lg-12">
					<div class="card">
						<div class="card-body">
							<h1 class="card-title">재고관리</h1>
							<!-- 탭 헤드 -->
							<div class="d-flex justify-content-between">
								<div class="">
									<ul class="nav nav-pills mb-3" id="commute-tab" role="tablist">
										<li class="nav-item" role="presentation">
											<button class="nav-link active" id="btn_grid_tab" data-bs-toggle="pill" data-bs-target="#tab_grid" 
											type="button" role="tab" aria-controls="tab_grid" aria-selected="false">그리드</button>
										</li>
										<li class="nav-item" role="presentation">
											<button class="nav-link" id="btn_tree_tab" data-bs-toggle="pill" data-bs-target="#tab_tree" 
											type="button" role="tab" aria-controls="tab_tree" aria-selected="true">트리</button>
										</li>
									</ul>
								</div>
							</div>
							<div id="filterModule" class="mb-3"></div>
							<!-- 탭 바디 -->
							<div class="tab-content pt-2" id="myTabContent">
								<!-- 그리드 탭 -->
								<div class="tab-pane fade show active" id="tab_grid" role="tabpanel" aria-labelledby="grid-tab">
									<div id="grid"></div>
									<div id="btn_area" class="mt-2">
										<button type="button" class="btn btn-primary" id="btn_insert">등록</button>
										<button type="button" class="btn btn-primary" id="btn_delete">삭제</button>
									</div>
								</div>
								<!-- 트리 탭 -->
								<div class="tab-pane fade" id="tab_tree" role="tabpanel" aria-labelledby="tree-tab">
									<div id="treeMapContainer">
									    <div id="treeMap"></div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
	</main>
</body>
<script th:inline="javascript">
	// 변수 지정
	let grid, treeMap;
	const btn_insert = $('#btn_insert');
	const btn_delete = $('#btn_delete');
	const token = $("meta[name='_csrf']").attr("content")
	const header = $("meta[name='_csrf_header']").attr("content");
	const filterConfig = [
	    { key: 'warehouse_cd', label: '보관창고', type: 'select', list: [], col: 'col' },
	    { key: 'warearea_cd', label: '창고구역', type: 'select', list: [], col: 'col' },
	    { key: 'item_gc', label: '품목대분류', type: 'select', list: [], col: 'col' },
	    { key: 'item_cc', label: '품목소분류', type: 'select', list: [], col: 'col' },
	    { key: 'item_nm', label: '품목명', type: 'text', placeholder: '품목명 입력', col: 'col' },
	];
	let commonList = [];
	let warehouseList = /*[[${warehouseList}]]*/[];

	// ------------------------------
	
	$(function() {
		setGridTheme();
		make_grid();
		getGridList();
		getList();
		setElementHeight('.card', -105);
		setElementHeight('#treeMapContainer', -320);
		setGridHeight(grid, -464);
		
		$(window).resize(function() {
			setTimeout(() => {
				setElementHeight('.card', -105);
				setElementHeight('#treeMapContainer', -320);
				setGridHeight(grid, -464);
				setGridWidth(grid, 0);
			}, 300);
		});
		
		$('#btn_grid_tab').on('click', function() {
			if(grid == null) {
				make_grid();
			}
			resetSearchInput(filterConfig);
			getGridList();
	        initializeFilterModule('filterModule', filterConfig, (filterValues) => {
	           	getGridList(filterValues);
	        });
			createSelectBox($('#warehouse_cd'), warehouseList, '선택하세요.');
			createSelectBox($('#item_gc'), commonList['PRDTYPE'], '선택하세요.');
		    if($('#btn_excel_download').length === 0) {
		        $('#resetFilter').before(
		        		'<input type="button" id="btn_excel_download" class="btn btn-primary me-2" value="엑셀">'
		        		);
		        
		        $('#btn_excel_download').on('click', function() {
		        	gridExcelDownload(grid, '출퇴근기록');
		        });
		    }
		});
		
		$('#btn_tree_tab').on('click', function() {
			if(treeMap == null) {
				make_treeMap();
			}
			getChartList();
	        initializeFilterModule('filterModule', filterConfig, (filterValues) => {
	        	getChartList(filterValues);
	        });
			createSelectBox($('#warehouse_cd'), warehouseList, '선택하세요.');
			createSelectBox($('#item_gc'), commonList['PRDTYPE'], '선택하세요.');

		});
		
		// 검색필터
        initializeFilterModule('filterModule', filterConfig, (filterValues) => {
           	getGridList(filterValues);
        });
		
		// 엑셀 버튼 추가
		addExcelButton(grid, '재고관리');
		
		$(document).on('filterToggled', function(e) {
		    if(e.detail.isVisible) {
		        setGridHeight(grid, -534);
		        setElementHeight('#treeMapContainer', -390);
		    } else {
		    	setGridHeight(grid, -464);
		        setElementHeight('#treeMapContainer', -320);
		    }
		});
		
		// 필터 엔터키 검색 이벤트
		$(document).on('keypress', '#filterModule', function(e) {
		    if (e.keyCode !== 13) return;
		    
		    const filterValues = {};
		    
		    for (const config of filterConfig) {
		        const input = $(`#${config.key}`);
		        const value = input.val();
		        filterValues[config.key] = value;
		    }
		    $('#tab_grid').hasClass('active')? getGridList(filterValues) : getChartList(filterValues);
		});
		
		$(document).on('change', '#filterModule select', function(e) {
		    const filterValues = {};
		    
		    for (const config of filterConfig) {
		        filterValues[config.key] = $(`#${config.key}`).val();
		    }
		    
		    $('#tab_grid').hasClass('active')? getGridList(filterValues) : getChartList(filterValues);
		});

		
		
		// 보관창고 선택
		$(document).on('change', '#warehouse_cd', function() {
			changeSelectBox('#warehouse_cd', '#warearea_cd', '/select_WAREAREA_CC', 'warehouse_cd');
		});
		
		// 보관구역 선택
		$(document).on('click', '#warearea_cd', function(ev) {
			if(!$('#warehouse_cd').val()) {
				showAlert($('#warehouse_cd'), 'info', '보관창고 선택', '보관창고를 먼저 선택해주세요.');
				return;
			}
		});
		
		// 품목대분류
		$(document).on('change', '#item_gc', function() {
			changeSelectBox('#item_gc', '#item_cc', '/select_PRODUCT_CC', 'product_gc');
		});
		
		// 보관구역 선택
		$(document).on('click', '#item_cc', function(ev) {
			if(!$('#item_gc').val()) {
				showAlert($('#item_gc'), 'info', '대분류 선택', '품목 대분류를 먼저 선택해주세요.');
				return;
			}
		});
		
		
		// 재고 삭제
		btn_delete.on('click', function() {
			let checkedRows = grid.getCheckedRows();
			if (!checkedRows.length) {
				showAlert('', 'warning', '삭제 항목 체크', '삭제할 재고를 체크해주세요.');
			    return;
			}
			// delete_PRODUCT(checkedRows, grid['flag']);				
		});
		
	});
	
	//  함수 --------------------------------
	
	// 검색 인풋 초기화
	function resetSearchInput(filter){
		$('#warehouse_cd').val('');
		$('#warearea_cd').val('');
		$('#item_gc').val('');
		$('#item_cc').val('');
		$('#item_nm').val('');
		if(!$('#additionalFilters').hasClass('d-none')) {
			$('#toggleFilters').click();
		}
		
	}


	// prefix 결정
	function getPrefix(flag) {
	    return flag ? 'product' : 'material';
	}
	
	// 인풋 입력
	function setModalValues(data, prefix) {
		console.log('입력할 데이터',data);
		createSelectBox($('#modal_product_cc'), data['ccList'], '선택하세요.');
		modal_product_cd.val(data[`${prefix}_cd`]);
		modal_product_nm.val(data[`${prefix}_nm`]);
		modal_product_gc.val(data[`${prefix}_gc`]);
		$('.div_select')[['HALFPRO', 'PRODUCT'].includes(data[`${prefix}_gc`]) ? 'show' : 'hide']();
		modal_product_cc.val(data[`${prefix}_cc`]);
		modal_product_gd.val(data[`${prefix}_gd`]);
		modal_product_un.val(data[`${prefix}_un`]);
		modal_product_pr.val(data[`${prefix}_pr`]);
		modal_product_wh.val(data[`${prefix}_wh`]);
		modal_product_us.val(data[`${prefix}_us`]);
		modal_product_rm.val(data[`${prefix}_rm`]);
	    if ($('.div_select').is(':visible')) {
	        $('#modal_product_sz').val(data['product_sz'].split(', ')).trigger('change');
	        $('#modal_product_cr').val(data['product_cr'].split(', ')).trigger('change');
	    }
	    if(data[`${prefix}_pc`]) {
			const imagePath = `/upload/${data[`${prefix}_pc`]}`;
	        $('.uploadText').hide();
	        $('.photoPreview').attr('src', imagePath).show();
	        $('#btn_image_remove').removeClass('d-none');
	    }
	}
	
	// 그리드, 모달 -----------------------
	
	// 그리드 생성
	function make_grid() {
		let sizeList = /*[[${commonList['SIZE']}]]*/ [];
		
		let baseColumns = [
			{header: '보관창고', name: 'WAREHOUSE_NM', sortable: true, filter: 'select', rowSpan: true,},
			{header: '보관구역', name: 'WAREAREA_NM', sortable: true, filter: 'select', rowSpan: true,},
		    {header: '품목대분류', name: 'ITEM_GN', sortable: true, filter: 'select'},
		    {header: '품목소분류', name: 'ITEM_CN', sortable: true, filter: 'select'},
		    // {header: '품목대분류코드', name: 'stock_cd', hidden: true},
		    // {header: '품목분류코드', name: 'stock_cd', hidden: true},
   		    {header: '품목코드', name: 'ITEM_CD', sortable: true, filter: 'text'},
		    {header: '품목명', name: 'ITEM_NM', sortable: true, filter: 'text'},
		    {header: '색상', name: 'COLOR_NM', sortable: true, filter: 'select'},
		    {header: '단위', name: 'ITEM_UN', align: 'center', sortable: true, filter: 'select'},
		    {header: '총 수량', name: 'STOCK_AQ', sortable: true},
		];
		let additionalColumns = [];
		
		for(let i = 0; i <sizeList.length; i++) {
			let temp = sizeList[i];
			let column = {header : `${temp['common_cc']}`, name : `SIZE_${temp['common_cc']}`, width: '50'};
			additionalColumns.push(column);
		}
		
		let endColumns = [
		    // {header: '비고', name: 'stock_rm', width: '200', sortable: true, filter: 'text'},
		];
		
		const finalColumns = [
		    ...baseColumns,
		    ...additionalColumns,
		    ...endColumns
		];
		grid = new tui.Grid({
			el : document.getElementById('grid'),
			data: [],
			scrollX : false,
			scrollY : true,
			rowHeaders : [
				{type : 'rowNum',}, 
				{type : 'checkbox',}, 
			],
			bodyHeight : 600,
		    header: {
				height: 60,
		        complexColumns: [
					{
						header: '사이즈',
						name: 'SIZE',
						childNames: sizeList.map(item => `SIZE_${item.common_cc}`)
					}
				]
			},
			columns : finalColumns,
			summary: {
			    height: 40,
			    position: 'bottom', // or 'top'
			    columnContent: {
			    	stock_rm: {
			            template: (valueMap) => {
			                return `총  ${valueMap.cnt} 건`
			            }
			        }
				},
			},
		});
		
		grid.on('dblclick', function(ev) {
			let row = grid.getRow(ev.rowKey);
			// make_modal_detail('update', grid['flag']);
			// setModalInput(row, getPrefix(grid['flag']));
		});
    }
	
	// 트리맵 차트
	function make_treeMap() {
		treeMap = Highcharts.chart('treeMap', {
	        chart: {
	            spacingTop: 0,
	            spacingBottom: 0,
	            spacingLeft: 100,
	            spacingRight: 100,
	            events: {
	                click: function (event) {
	                	console.log('이벤트는', event);
	                    const label = this.renderer.label(
	                        'x: ' + Highcharts.numberFormat(event.xAxis[0].value, 2) +
	                        ', y: ' + Highcharts.numberFormat(event.yAxis[0].value, 2),
	                        event.xAxis[0].axis.toPixels(event.xAxis[0].value),
	                        event.yAxis[0].axis.toPixels(event.yAxis[0].value)
	                    )
	                        .attr({
	                            fill: Highcharts.getOptions().colors[0],
	                            padding: 10,
	                            r: 5,
	                            zIndex: 8
	                        })
	                        .css({
	                            color: '#FFFFFF'
	                        })
	                        .add();

	                    setTimeout(function () {
	                        label.fadeOut();
	                    }, 1000);
	                }
	            }
	        },
	        title: {
	            text: '내맘대로 할거야'
	        },
	        series: [{
	            type: 'treegraph',
	            data: [],
	            tooltip: {
	                pointFormat: '{point.name}'
	            },
	            marker: {
	                symbol: 'rect',
	                width: '10%',
	                height: 30
	            },
	            nodeWidth: 'auto',
	            borderRadius: 10,
	            dataLabels: {
	                style: {
	                    fontSize: '14px',
	                    fontWeight: 'bold',
	                    textOutline: '1px contrast'
	                }
	            },
	            levels: [{
	                level: 1,
	                levelIsConstant: false,
	                nodeDistance: '10%',
	                dataLabels: {
	                    style: { fontSize: '16px' }
	                }
	            }, {
	                level: 2,
	                colorByPoint: true,
	                dataLabels: {
	                    style: { fontSize: '14px' }
	                },
	                nodeDistance: '10%'
	            }, {
	                level: 3,
	                colorVariation: {
	                    key: 'brightness',
	                    to: -0.5,
	                    nodeDistance: '10%'
	                }
	            }, {
	                level: 4,
	                colorVariation: {
	                    key: 'brightness',
	                    to: 0.5,
	                    nodeDistance: '10%'
	                }
	            }],
	        }]
	    });
		
		/*
		setTimeout(() => {
		    const panZoom = svgPanZoom('#treeMap svg', {
		        zoomEnabled: true, // 확대/축소 활성화
		        // controlIconsEnabled: true, // 확대/축소 버튼 표시
		        fit: true, // 초기 화면 맞춤
		        center: true, // 초기 화면 중앙 정렬
		        minZoom: 0.5, // 최소 줌 레벨
		        maxZoom: 10, // 최대 줌 레벨
		        zoomScaleSensitivity: 0.2 // 줌 속도 조정
		    });
		}, 0);
		*/
	}
	
	// 차트 데이터 설정
	function setChartData(resultData) {
		let treeObjs = [];
		let warehouseMap = {};
		
		resultData.forEach(row => {
	    	let whId = row.WAREHOUSE_CD;   // 창고 ID
		    let whName = row.WAREHOUSE_NM; // 창고 이름
		    let areaId = row.WAREAREA_CD;  // 구역 ID
		    let areaName = row.WAREAREA_NM; // 구역 이름
		    let itemName = row.ITEM_NM;
		    let color = row.COLOR_NM;         // 색상
		    let size = row.SIZE;           // 사이즈
		    let qty = row.STOCK_AQ;        // 재고 수량
		    let stockType = row.STOCK_TP;  // 재고 타입 (Y/N)
		    
		    // 창고 노드 생성
		    if (!warehouseMap[whId]) {
		        warehouseMap[whId] = {
		            id: whId,
		            parent: '',
		            name: whName,
		            children: {}
		        };
		        treeObjs.push(warehouseMap[whId]);
		    }
		    let whNode = warehouseMap[whId];
		    
		    // 구역 노드 생성
		    if (!whNode.children[areaId]) {
		        whNode.children[areaId] = {
		            id: `${whId}-${areaId}`,
		            parent: whId,
		            name: areaName,
		            children: {}
		        };
		    }
		    let areaNode = whNode.children[areaId];
		    
		    if (stockType === 'Y') {
		        // 제품 노드 생성
		        if (!areaNode.children[itemName]) {
		            areaNode.children[itemName] = {
		                id: `${whId}-${areaId}-${itemName}`,
		                parent: areaNode.id,
		                name: `${itemName}`,
		                children: {}
		            };
		        }
		        let itemNode = areaNode.children[itemName];
		
		        // 색상 노드 생성
		        if (!itemNode.children[color]) {
		        	itemNode.children[color] = {
		                id: `${whId}-${areaId}-${color}`,
		                parent: itemNode.id,
		                name: `${color}`,
		                children: {}
		            };
		        }
		        let colorNode = itemNode.children[color];
		
		        // 사이즈 노드 생성 (최종 노드)
		        let sizeNode = {
		            id: `${whId}-${areaId}-${color}-${size}`,
		            parent: colorNode.id,
		            name: `${size} (${qty}개)`
		        };
		        colorNode.children[size] = sizeNode;
		    } else if (stockType === 'N') {
		        // 개수 노드 생성
		        if (!areaNode.children['count']) {
		            areaNode.children['count'] = {
		                id: `${whId}-${areaId}-count`,
		                parent: areaNode.id,
		                name: `${itemName} (${qty}개)`
		            };
		        }
		    }
		});
		
		const flatData = [];
		function flattenTree(node) {
		    flatData.push({ id: node.id, parent: node.parent, name: node.name });
		    if (node.children) {
		        for (let key in node.children) {
		            flattenTree(node.children[key]);
		        }
		    }
		}
		treeObjs.forEach(n => flattenTree(n));
		return flatData;
	}

	// ajax 함수 --------------------
	// 공통코드 조회
	async function getList() {
		commonList = await getCommonList("PRDTYPE");
		createSelectBox($('#warehouse_cd'), warehouseList, '선택하세요.');
		createSelectBox($('#item_gc'), commonList['PRDTYPE'], '선택하세요.');
	}
	
	// 그리드 조회
	async function getGridList(filter = {}) {
	    try {
	        const jsonData = {
	            stockFilter: {
					...filter,
				}
	        };
	        
	        const ajaxData = await callAjaxPost(`/select_STOCK_list`, JSON.stringify(jsonData));
	        grid.resetData(ajaxData.data.contents);
	    } catch (error) {
	        console.log(error);
	        showAlert('', 'error', '조회 실패', error.msg);
	    }
	}
	
	// 차트 조회
	async function getChartList(filter = {}) {
		try {
	        const jsonData = {
	            stockFilter: {
					...filter,
				}
	        };
			
		    const ajaxData = await callAjaxPost(`/select_STOCK_chart`, JSON.stringify(jsonData));
			
			let chartList = ajaxData['list'];
			let data = setChartData(chartList);
			treeMap.series[0].setData(data, true);
			let height = chartList.length * 40;
	        $('#treeMap').css('height', (height > 100 ? height : 500) + 'px');				
		} catch(error) {
	        console.log(error);
	        showAlert('', 'error', '조회 실패', error.msg);
		}
		
	}
	
	// 품목 대분류 선택
	async function changeSelectBox(sourceId, targetId, api, key, rowValue) {
		const source = sourceId && $(`${sourceId}`);
		const value = source?.val() || rowValue;

	    try {
	        let ajaxData = await callAjaxPost(api, JSON.stringify({[key]: value}));
	        createSelectBox($(`${targetId}`), ajaxData['list'], '선택하세요.');
	    } catch (error) {
	        showAlert('', 'error', '조회 실패', error.msg);
	    }
	}
	
	/*
	
	// 모달 조회
	async function setModalInput(row, prefix) {
		console.log('읽을데이터', row);
		let data = {
			[`${prefix}_cd`]: row[`${prefix}_cd`],
			[`${prefix}_cc`]: row[`${prefix}_cc`]
		}
		let jsonData = JSON.stringify(data);
		try {
		    let ajaxData = await callAjaxPost(`/select_${prefix.toUpperCase()}_detail`, jsonData);
			let item = ajaxData[prefix];
			console.log('ajax 아이템', item);
			modalData = {
				[`${prefix}_cd`]: item[`${prefix}_cd`],
				[`${prefix}_nm`]: item[`${prefix}_nm`],
				[`${prefix}_pc`]: item[`${prefix}_pc`],
				[`${prefix}_gc`]: item[`${prefix}_gc`],
				[`${prefix}_cc`]: item[`${prefix}_cc`],
				[`${prefix}_gd`]: item[`${prefix}_gd`],
				[`${prefix}_un`]: item[`${prefix}_un`],
				[`${prefix}_pr`]: item[`${prefix}_pr`],
				...(prefix == 'product' ? {
				    product_sz: item['product_sz'],
				    product_cr: item['product_cr']
				} : {}),
				[`${prefix}_wh`]: item[`${prefix}_wh`],
				[`${prefix}_us`]: item[`${prefix}_us`] == true ? 1 : 0,
				[`${prefix}_rm`]: item[`${prefix}_rm`],
				ccList: ajaxData['product_cc'],
			};
			console.log('modaldata', modalData);
			setModalValues(modalData, prefix);
		} catch (error) {
			console.log(error)
			showAlert('', 'error', '조회 실패', error.msg);
		}
	}
	

	
	// 품목 등록
	async function insert_PRODUCT(flag) {
		let prefix = getPrefix(flag);
		let text = Object.keys(modalData).length > 0 ? '수정' : '등록';
	    const validations = [
	        { field: modal_product_cd, message: '품목코드를 입력해주세요.' },
	        { field: modal_product_nm, message: '품목명을 입력해주세요.' },
	        { field: modal_product_gc, message: '품목대분류를 선택해주세요.' },
	        { field: modal_product_cc, message: '품목소분류를 선택해주세요.' },
	        { field: modal_product_sz, message: '사이즈를 선택해주세요.', isMultiple: true, checkIf: () => $('.div_select').is(':visible') },
	        { field: modal_product_cr, message: '색상을 선택해주세요.', isMultiple: true, checkIf: () => $('.div_select').is(':visible') },
	        { field: modal_product_gd, message: '성별을 선택해주세요.', checkIf: () => $('.div_select').is(':visible') },
	        { field: modal_product_un, message: '기준단위를 선택해주세요.' },
	        { field: modal_product_pr, message: '기준단가를 입력해주세요.' },
	        { field: modal_product_wh, message: '보관창고를 선택해주세요.' },
	        { field: modal_product_us, message: '사용여부를 선택해주세요.' }
	    ];

	    const invalidField = validations.find(v => {
	        if (v.checkIf && !v.checkIf()) return false;
	        const value = v.field.val();
	        return v.isMultiple ? (!value || value.length === 0) : !value?.trim();
	    });

	    if (invalidField) {
	        showAlert(invalidField.field, 'warning', '', invalidField.message);
	        return;
	    }

		if(!await showConfirm(`품목 ${text}`, `품목을 ${text}하시겠습니까?`)) {
			return;
		}
		
	    const formData = new FormData();
	    
	    // 기본 제품 정보
	    const data = {
	        [`${prefix}_cd`]: modal_product_cd.val().trim(),
	        [`${prefix}_nm`]: modal_product_nm.val().trim(),
	        [`${prefix}_gc`]: modal_product_gc.val(),
	        [`${prefix}_cc`]: modal_product_cc.val(),
	        [`${prefix}_gd`]: modal_product_gd.val(),
	        [`${prefix}_un`]: modal_product_un.val(),
	        [`${prefix}_pr`]: modal_product_pr.val(),
	        [`${prefix}_wh`]: modal_product_wh.val(),
	        [`${prefix}_us`]: modal_product_us.val() == 1,
	        [`${prefix}_rm`]: modal_product_rm.val().trim()
	    };

	    const requestData = {
	        [prefix]: data,
	        ...($('.div_select').is(':visible') ? {
	            sizeList: modal_product_sz.val(),
	            colorList: modal_product_cr.val()
	        } : {}),
	    };

	    formData.append('requestData', new Blob([JSON.stringify(requestData)], {type: 'application/json'}));

	    const imageFile = $('#product_pc')[0].files[0];
	    if (imageFile) {
	        formData.append('image', imageFile);
	    }
	    
		try {
		    let ajaxData = await callAjaxFileUpload(`/insert_${prefix.toUpperCase()}`, formData);
			grid.resetData(ajaxData['list']);
			resetSearchInput();
			modal.hide();
			showAlert('', 'success', `${text} 성공`, `${text}에 성공하였습니다.`);
		} catch (error) {
			console.log(error);
			console.log('실패');
			showAlert('', 'error', `${text} 실패`, `${text}에 실패하였습니다.`);
		}
	}
	
	// 품목 삭제
	async function delete_PRODUCT(checkedRows, flag) {
		let prefix = getPrefix(flag);
		if (!await showConfirm(`품목 삭제`, '선택한 품목을 삭제하시겠습니까?')) { 
			return;
		}
		let data = {
			[`${prefix}List`]: checkedRows,
			[`${prefix}_gc`]: groupValue
		}
		
		let ajaxData = await callAjaxPost(`/delete_${prefix.toUpperCase()}`, JSON.stringify(data));
		try {
			grid.resetData(ajaxData['list']);
			resetSearchInput();
			showAlert('', 'success', '삭제 성공', '삭제에 성공했습니다.');
		} catch (error) {
			console.log(error);
			showAlert('', 'error', '삭제 실패', error['msg']);
		}
	}
	
*/

</script>
</html>