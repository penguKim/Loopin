<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
				xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
				layout:decorate="~{layout}" 
				layout:fragment="content">
<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
	<body>
		<main id="main" class="main">
			<div class="card">
				<div class="card-body">
					<h5 class="card-title">연차 발생 등록</h5>
					<p class="card-text">예상 연차</p>
					<!-- 그리드 컨테이너 -->
					<div id="grid_container"></div>
					<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#verticalycentered">등록</button>
					<!-- 모달창 -->
					<div class="modal fade" id="verticalycentered" tabindex="-1">
						<div class="modal-dialog modal-dialog-centered">
							<div class="modal-content">
								<div class="modal-header">
									<h5 class="modal-title">Vertically Centered</h5>
									<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
								</div>
								<div class="modal-body">2025년 연차 등록 완료하시겠습니까?</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
									<button type="button" class="btn btn-primary" id="btn_insert_ANNUAL">등록</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</main>
	</body>
<script th:inline="javascript">
	/*const grid_container = document.getElementById('grid_container');
	const btn_insert_ANNUAL = document.getElementById('btn_insert_ANNUAL');
	const token = $("meta[name='_csrf']").attr("content");
	const header = $("meta[name='_csrf_header']").attr("content");

	// 첫 로딩
	window.onload = function(){
		grid_function();
	}
	
	// 연차 등록 버튼
	btn_insert_ANNUAL.addEventListener("click", function(){
		const today = new Date();
		const year = today.getFullYear();
		const formattedDate = `${year}`;
		
		$.ajax({
			type: "POST",
			url: "/insert_ANNUAL",
			dataType: 'json',
			contentType : 'application/json',
			beforeSend : function(xhr){
				xhr.setRequestHeader(header, token);
			},
			data: 
				JSON.stringify({annual_yr : formattedDate}),
			success: function(result) {
				console.log('조회 성공');
				grid.resetData(result);
			},
			error : function(result) {
				console.log('조회 실패');
			}
		});
		
		
	});
	
	
	// 그리드 함수
	function grid_function(){ 
		
		// 처음 불러오는 데이터
		$.ajax({
			type: "get",
			url: "/select_base_ATTENDANCE",
			dataType: 'json',
			success: function(result) {
				grid.resetData(result);
				console.log('조회 성공');
			},
			error : function(result) {
				console.log('조회 실패');
			}
		});
		
		// 필터 클릭할때마다 데이터 바뀌도록
		let grid_data= { 
			api: {
				readData: {url: 'select_base_ATTENDANCE', method:'GET'},
			}
		}
		
		// 그리드 객체 생성 + 초기 세팅
		const grid = new tui.Grid({
			el: grid_container,
			data: grid_data,
			scrollX: false,
			scrollY: false,
			columns: [
				{
					header: '이름', // 출력명
					name: 'annual_id', // 칼럼명
					align: 'center',
					sortable: true,
				},
				{
					header: '부서명', 
					name: 'employee_cd',
					align: 'center',
					sortable: true,
				},
				{
					header: '입사일',
					name: 'annual_cc',
					align: 'center',
					sortable: true,
					
				},
				{
					header: '근속연수', 
					name: 'annual_yr',
					align: 'center',
					sortable: true,
				},
				{
					header: '사용연차',
					name: 'annual_ua',
					align: 'center',
					sortable: true,
				},
				{
					header: '남은연차',
					name: 'annual_ra',
					align: 'center',
					sortable: true,
				},
				{
					header: '총연차',
					name: 'annual_aa',
					align: 'center',
					sortable: true,
				},
				
			],
		});
	}
	
	// 모달 초기화
	$('.modal').on('hidden.bs.modal', function (e) {
	    $(this).find('form')[0].reset();
	}); 
	*/
	
	// 일단 공휴일 정보 불러와짐
	
	var xhr = new XMLHttpRequest();
	var url = 'http://apis.data.go.kr/B090041/openapi/service/SpcdeInfoService/getRestDeInfo'; /*URL*/
	var queryParams = '?' + encodeURIComponent('serviceKey') + '=' + '%2BaS8Oo1w1bIwCjPOfx%2B2GP%2BLgO7P3KRXXhgj4TkMdyIC%2FyEtgb%2Fsv6vWOTbcRDg5veR%2FR2SE6fm3tWN9%2BwmFUQ%3D%3D'; /*Service Key*/
	queryParams += '&' + encodeURIComponent('solYear') + '=' + encodeURIComponent('2025'); /*년도 설정*/
	queryParams += '&' + encodeURIComponent('numOfRows') + '=' + encodeURIComponent('30'); /*결과 행 수*/

	xhr.open('GET', url + queryParams);
	xhr.onreadystatechange = function () {
	    if (this.readyState == 4) {
	        if (this.status == 200) {
	            console.log("응답 성공");

	            // XML 데이터를 파싱
	            var parser = new DOMParser();
	            var xmlDoc = parser.parseFromString(this.responseText, "text/xml");

	            // 데이터를 저장할 객체 초기화
	            var data = {};

	            // XML에서 <item> 태그 추출
	            var items = xmlDoc.getElementsByTagName("item");
	            for (var i = 0; i < items.length; i++) {
	                // <locdate>와 <dateName> 데이터 추출
	                var locdate = items[i].getElementsByTagName("locdate")[0].textContent; // 설명
	                var dateName = items[i].getElementsByTagName("dateName")[0].textContent; // 날짜

	                // 데이터를 객체에 저장
	                data[locdate] = dateName;
					
	            }

	            // 결과 출력
	            console.log(data);
				
				// 해야하는게 data에서 각 날짜 추출하는 것
				
	        } else {
	            console.error('오류 발생. HTTP 상태 코드:', this.status);
	        }
			
			
	    }
	};

	xhr.send('');

</script>
</html>