<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
				xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
				xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
				layout:decorate="~{layout}" 
				layout:fragment="content">
<meta name="_csrf" th:content="${_csrf.token}"/>
<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
<body>
	<main id="main" class="main">
		<section class="section">
			<div class="row">
				<div class="col-lg-12">
					<div class="card"  style="height:800px;">
						<div class="card-body">
							<div class="d-flex align-items-center justify-content-between">
								<h5 class="card-title">휴가 등록</h5>
								<div>
									<input type="button" id="btn_annual_modal" class="btn btn-primary" value="연차등록" data-bs-toggle="modal" data-bs-target="#modal_appointment_save">
									<div class="modal fade" id="modal_appointment_save" tabindex="-1" aria-labelledby="modal_appointment_save_label" aria-hidden="true" data-bs-backdrop="false" data-bs-keyboard="false" >
										<div class="modal-dialog modal-dialog-centered modal-md">
											<div class="modal-content">
												<div class="modal-header">
													<h5 class="modal-title" id="modal_appointment_save_label">연차 등록</h5>
													<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
												</div>
												<div class="modal-body">
													<div class="col">
														<div class="input-group">
															<table class="table table-striped">
															    <thead>
															        <tr>
															            <th scope="col">근속 연수</th>
															            <th scope="col">발생 연차 일수</th>
															        </tr>
															    </thead>
															    <tbody>
															        <tr>
															            <td>1년 미만</td>
															            <td>1개월 경과 시 1일 (최대 11일)</td>
															        </tr>
															        <tr>
															            <td>1년 이상 ~ 3년 미만</td>
															            <td>15일</td>
															        </tr>
															        <tr>
															            <td>3년</td>
															            <td>16일</td>
															        </tr>
															        <tr>
															            <td>5년</td>
															            <td>17일</td>
															        </tr>
															        <tr>
															            <td>7년</td>
															            <td>18일</td>
															        </tr>
															        <tr>
															            <td>...</td>
															            <td>...</td>
															        </tr>
															        <tr>
															            <td>23년 이상</td>
															            <td>최대 25일</td>
															        </tr>
															    </tbody>
															</table>
														</div>
													</div>
													<div class="modal-footer">
														<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
														<button type="button" class="btn btn-primary" id="btn_insert_ANNUAL">등록</button>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
<!--							<div class="d-flex align-items-center justify-content-between">-->
<!--								<form id="modal_appointment_save" method="get" th:action="@{/select_ANNUAL}">-->
<!--									<div class="row mb-3">-->
<!--										<div class="col">-->
<!--											<input type="text" id="employ_nm" class="form-control">-->
<!--										</div>-->
<!--										<div class="col">-->
<!--											<button type="submit" class="btn btn-primary" id="btn_select_ANNUAL">검색</button>-->
<!--										</div>-->
<!--									</div>-->
<!--								</form>-->
<!--							</div>-->
							<div id="grid_container"></div>
						</div>
					</div>
				</div>

			</div>
		</section>
	</main>
</body>
<script th:inline="javascript">
	const token = $("meta[name='_csrf']").attr("content");
	const header = $("meta[name='_csrf_header']").attr("content");
	const grid_container = document.getElementById('grid_container');
	let grid = null;
	const modal_appointment_save = new bootstrap.Modal(document.getElementById('modal_appointment_save'));
	
	
	window.onload = function(){
		grid_function();
		
	}
	
	// grid_function에서 grid 초기화 및 설정
	function grid_function() {

	    // 처음 불러오는 데이터
	    $.ajax({
	        type: "get",
	        url: "/select_ATTENDANCE",
	        success: function (result) {
	            grid.resetData(result);
	        },
			error : function(xhr, textStatus, errorThrown) {
				console.log('조회 실패', xhr.responseText);
			}
	    });

	    // 그리드 객체 생성 + 초기 세팅
	    grid = new tui.Grid({
	        el: grid_container,
	        scrollX: true,
	        scrollY: true,
	        columns: [
	            { header: '사용년도', name: 'annual_yr', align: 'center', sortable: true },
	            { header: '이름', name: 'employee_nm', align: 'center', sortable: true },
	            { header: '부서명', name: 'common_nm', align: 'center', sortable: true },
	            { header: '근속연수', name: 'service_years', align: 'center', sortable: true },
	            { header: '사용연차', name: 'annual_ua', align: 'center', sortable: true },
	            { header: '잔여연차', name: 'annual_ra', align: 'center', sortable: true },
	            { header: '예상 총연차', name: 'expect_annual', align: 'center', sortable: true },
	        ],
	    });
	}
	
	$('#btn_insert_ANNUAL').on("click", function () {
		let annual_yr = new Date().getFullYear(); // 현재 연도 가져오기
		
		$.ajax({
			type: 'post',
			url: '/insert_ANNUAL',
			data: {"annual_yr": annual_yr},
			contentType: 'application/json',
			beforeSend : function(xhr) {
			    xhr.setRequestHeader(header, token);
			},
			success: function (result) {
				modal_appointment_save.hide();
				location.reload();
	        },
			error : function(xhr, textStatus, errorThrown) {
				console.log('조회 실패', xhr.responseText);
				Swal.fire({
				    icon: "error",
				    title: "입력할 연차가 없습니다",
				    text: `이미 완료되었거나 아직 등록할 수 없습니다.`,
				});
			}
		});
	});
	
	$('.modal').on('hidden.bs.modal', function (e) {
	    $(this).find('form')[0].reset();
	});
	
</script>
</html>