<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout}" layout:fragment="content">

<body>
	<main id="main" class="main">
		<section class="section">
			<div class="row">
				<div class="col-lg-12">

					<div class="card">
						<div class="card-body">
							<h5 class="card-title">로그</h5>

							<!-- General Form Elements -->

							<div id="grid"></div>
							<br>

							<!-- End General Form Elements -->

						</div>
					</div>

				</div>


			</div>
		</section>

	</main>

	<div id="grid"></div>

	<!-- Modal -->
	<div class="modal fade" id="logDetailModal" tabindex="-1" aria-labelledby="logDetailModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="logDetailModalLabel">Log Details</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<!-- JSON Data Display -->
					<pre id="modalLogDetails" class="bg-light p-3 rounded"
						style="white-space: pre-wrap; word-wrap: break-word;"></pre>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
				</div>
			</div>
		</div>
	</div>


</body>

<script th:inline="javascript">
	document.addEventListener('DOMContentLoaded', function () {
		fetch('/select_LOG', {
			method: 'GET',
			headers: {
				'Content-Type': 'application/json'
			}
		})
			.then(response => {
				if (!response.ok) {
					throw new Error('네트워크 응답이 실패했습니다.');
				}
				return response.json();
			})
			.then(logData => {
				console.log('서버 응답 데이터:', logData);

				// Grid 초기화
				const grid = new tui.Grid({
					el: document.getElementById('grid'),
					data: logData.map(row => ({
						log_cd: row.log_cd,
						employee_id: row.employee_id || '', // null 값 처리
						log_sj: row.log_sj,
						log_ju: row.log_ju,
						log_jd: row.log_jdMap ? JSON.stringify(row.log_jdMap, null, 2) : '', // JSON 변환 후 표시
						log_od: row.log_od,
						log_oi: row.log_oi,
						log_bj: row.log_bj,
					})),
					columns: [
						{header: '로그 코드', name: 'log_cd', align: 'center', sortable: true},
						{header: '직원 ID', name: 'employee_id', align: 'center', sortable: true},
						{header: '로그 제목', name: 'log_sj', align: 'center', sortable: true},
						{header: '작업 내용', name: 'log_ju', align: 'center', sortable: true},
						{
							header: '세부 정보',
							name: 'log_jd',
							align: 'center',
							sortable: true,
							onCellClicked: function (event) {
								// log_jd 클릭 시 모달 표시
								const logDetails = event.value || 'No details available';
								document.getElementById('modalLogDetails').innerText = logDetails; // 모달 내용 업데이트
								const modal = new bootstrap.Modal(document.getElementById('logDetailModal')); // 모달 표시
								modal.show();
							}
						},
						{header: '로그 시간', name: 'log_od', align: 'center', sortable: true},
						{header: 'IP 주소', name: 'log_oi', align: 'center', sortable: true},
						{header: '브라우저 정보', name: 'log_bj', align: 'center', sortable: true}
					],
					rowHeaders: ['checkbox'],
					autoWidth: true,
					rowHeight: 'auto',
					bodyHeight: 'fitToParent',
					scrollX: true,
					scrollY: true
				});
			})
			.catch(error => {
				console.error('오류 발생:', error);
			});
	});

</script>

</html>