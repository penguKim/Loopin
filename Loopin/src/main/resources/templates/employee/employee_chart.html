<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
				xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
				layout:decorate="~{layout}" 
				layout:fragment="content">
<body>
	<main id="main" class="main">
		<section class="section">
			<div class="row">
				<div class="col-lg-12">
					<div class="card">
						<div class="card-body">
							<h5 class="card-title">남녀성비현황</h5>
							<div id="chart-area"></div>
						</div>
					</div>
				</div>
			</div>
		</section>
	</main>
</body>

<script th:inline="javascript">
$(document).ready(function () {
    // CSRF 토큰 및 헤더 설정
    const csrfToken = document.querySelector('meta[name="_csrf"]').getAttribute('content');
    const csrfHeader = document.querySelector('meta[name="_csrf_header"]').getAttribute('content');

    // AJAX를 사용하여 데이터 가져오기
    $.ajax({
        url: '/select_GENDER',
        method: 'GET',
        headers: {
            [csrfHeader]: csrfToken // CSRF 토큰 헤더 추가
        },
        success: function (response) {
            // 서버에서 반환된 데이터를 Toast UI Chart 형식으로 변환
            const data = {
                series: response.series
            };

            // 차트 옵션 설정
            const options = {
                chart: { 
                    title: '남녀 성비 현황', 
                    width: 600, 
                    height: 400 
                },
            };

            // 차트 렌더링
            const el = document.getElementById('chart-area');
            toastui.Chart.pieChart({ el, data, options });
        },
        error: function (xhr, status, error) {
            console.error('Error fetching data:', error);
        }
    });
});

</script>

</html>