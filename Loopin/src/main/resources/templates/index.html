<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" 
				xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" 
				layout:decorate="~{layout}" 
				layout:fragment="content">
<body>
	
	<main id="main" class="main">
		<div class="pagetitle">
			<h1></h1>
		</div>
		<section class="section dashboard">
			<div class="row">
				<!--왼쪽 시작 -->
				<div class="col-lg-8">
					<div class="row">
						
						<!-- 왼쪽 1번째 위 -->
						<div id="calendar" style="height: 800px; margin-bottom: 30px;">
						</div>

						<!-- 왼쪽 2번째 중간 -->
<!--						<div class="col-12">-->
<!--							<div class="card top-selling overflow-auto">-->
<!--								<div class="card-body pb-0">-->
<!--									<h5 class="card-title">남은 휴가</h5>-->
<!--									<table class="table table-borderless">-->
<!--										<thead>-->
<!--											<tr>-->
<!--												<th scope="col">총 휴가 일수</th>-->
<!--												<th scope="col">사용한 휴가 일수</th>-->
<!--												<th scope="col">남은 휴가 일수</th>-->
<!--											</tr>-->
<!--										</thead>-->
<!--										<tbody>-->
<!--											<tr>-->
<!--												<td th:text="${['ANNUAL_AA']}"></td>-->
<!--												<td th:text="${['ANNUAL_UA']}"></td>-->
<!--												<td th:text="${['ANNUAL_RA']}"></td>-->
<!--											</tr>-->
<!--										</tbody>-->
<!--									</table>-->
<!--								</div>-->
<!--							</div>-->
<!--						</div>-->
					</div>
				</div>

				<!-- 오른쪽 시작 -->
				<div class="col-lg-4">

					<!-- 오른쪽 1번째 위 -->
					<div class="card">
						<div class="card-body">
							<!-- Card with titles, buttons, and links -->
							<h5 class="card-title">오늘 근무</h5>
							<h6 class="card-subtitle mt-3" th:text="${['EMPLOYEE_NM']}"></h6>
							<h6 class="card-subtitle mt-3" th:text="|${['COMMON_NM']}팀|"></h6>
							<h6 class="card-subtitle mt-3" id="current_day"></h6>
							<h6 class="card-subtitle mt-3" th:if="${WORKINGHOUR_WT != null and WORKINGHOUR_WT != '' and WORKINGHOUR_LT != null and WORKINGHOUR_LT != ''}" th:text="|근무일정 : ${['WORKINGHOUR_WT']} - ${['WORKINGHOUR_LT']}|"></h6>
							<div class="d-flex justify-content-between">
								<input type="button" id="btn_attendance" class="btn btn-primary flex-fill mx-4" value="출근하기" th:disabled="${isAttendance}">
								<input type="button" id="btn_leave_work" class="btn btn-primary flex-fill mx-4" value="퇴근하기" th:disabled="${isLeaveWork}">
							</div>
						</div>
					</div><!-- End Recent Activity -->
					
					<!-- 오른쪽 2번째 중간 -->
					<div class="card">
						<div class="card-body">
<!--							<h5 class="card-title">공지사항</h5>-->
<!--							<ul class="list-group list-group-flush">  나중에 긴급공지면 빨간색 css-->
<!--								<li class="list-group-item"><a href="/log">[긴급공지] 재택 근무 규정 변경 안내</a></li>-->
<!--								<li class="list-group-item"><a href="/log">[공지] 결재 요청 가이드라인</a></li>-->
<!--								<li class="list-group-item"><a href="/log">[사내공지] 휴가 사용 안내</a></li>-->
<!--								<li class="list-group-item"><a href="/log">[공지] 재택 근무 규정 변경 안내</a></li>-->
<!--								<li class="list-group-item"><a href="/log" style="float: right;">전체보기 (80) ></a></li>-->
<!--							</ul> End Clean list group -->
							<h5 class="card-title">남은 휴가</h5>
							<table class="table table-borderless">
								<thead>
									<tr>
										<th scope="col">총 휴가 일수</th>
										<th scope="col">사용한 휴가 일수</th>
										<th scope="col">남은 휴가 일수</th>
									</tr>
								</thead>
								<tbody>
									<tr>
										<td th:text="${['ANNUAL_AA']}"></td>
										<td th:text="${['ANNUAL_UA']}"></td>
										<td th:text="${['ANNUAL_RA']}"></td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
					
					<!-- 오른쪽 3번째 아래 -->
					<div class="card">
						<div class="card-body">
							<h5 class="card-title">나의 결재현황</h5>
							<ul class="list-group list-group-flush"> <!-- 나중에 긴급공지면 빨간색 css-->
								<li class="list-group-item"><a href="/log">[공지] 결재 요청 가이드라인</a></li>
								<li class="list-group-item"><a href="/log">발주서 품의</a></li>
								<li class="list-group-item"><a href="/log">출장보고서</a></li>
								<li class="list-group-item"><a href="/log">[긴급] 비품신청서</a></li>
								<li class="list-group-item"><a href="/log" style="float: right;">전체보기 (10) ></a></li>
							</ul><!-- End Clean list group -->
						</div>
					</div>
				</div>
		</section>
	</main><!-- End #main -->
	
</body>
<script th:inline="javascript">
	// 변수
	const token = $("meta[name='_csrf']").attr("content")
	const header = $("meta[name='_csrf_header']").attr("content");


	//const {year, month, day} = formatDate();
	$(function () {
		const { year, month, day, hours, minutes, seconds } = formatDate(); // 함수가 반환한 값 사용

		// <h1> 태그의 텍스트를 동적으로 업데이트
		$(".pagetitle h1").text(`${year}년 ${month}월`);
		$("#current_day").text(`${year}년 ${month}월 ${day}일`);
		$("#current_time").text(`${year}-${month}-${day} ${hours}:${minutes}:${seconds} `);
		
	});
	
	
	function formatDate() {
		const originalDate = new Date(); // 기존 날짜 가져오기
	    const year = originalDate.getFullYear();
	    const month = String(originalDate.getMonth() + 1).padStart(2, '0'); // 2자리로 포맷
	    const day = String(originalDate.getDate()).padStart(2, '0'); // 2자리로 포맷
	    const hours = String(originalDate.getHours()).padStart(2, '0'); // 2자리로 포맷
	    const minutes = String(originalDate.getMinutes()).padStart(2, '0'); // 2자리로 포맷
	    const seconds = String(originalDate.getSeconds()).padStart(2, '0'); // 2자리로 포맷

	    // 리턴값 확장
	    return {
	        year,
	        month,
	        day,
	        hours,
	        minutes,
	        seconds
	    };
	}
	
	const calendar = new tui.Calendar('#calendar', {
			defaultView: 'month',
			template: {
				time(event) {
					const { start, end, title } = event;

					return `<span style="color: white;">${formatTime(start)}~${formatTime(end)} ${title}</span>`;
			},
				allday(event) {
					return `<span style="color: gray;">${event.title}</span>`;
				},
			},
			calendars: [
				{
					id: 'cal1',
					name: 'Personal',
					backgroundColor: '#03bd9e',
				},
				{
					id: 'cal2',
					name: 'Work',
					backgroundColor: '#00a9ff',
				},
			],
			
			
			
		});
		
		calendar.createEvents([
			  {
			    id: '1',
			    calendarId: '1',
			    title: 'my event',
			    category: 'time',
			    dueDateClass: '',
			    start: '2024-12-18T22:30:00+09:00',
			    end: '2024-12-19T02:30:00+09:00',
			  },
			  {
			    id: '2',
			    calendarId: '1',
			    title: 'second event',
			    category: 'time',
			    dueDateClass: '',
			    start: '2018-01-18T17:30:00+09:00',
			    end: '2018-01-19T17:31:00+09:00',
			  },
			]);
		
		const timedEvent = calendar.getEvent('1', '1'); // EventObject
		calendar.on('clickEvent', ({ event }) => {
		console.log(event); // EventObject
	});
	
	// 출근하기
	$('#btn_attendance, #btn_leave_work').on('click', function() {
		console.log('asdasd');
		let isAttendance = $(this).attr('id') == 'btn_attendance';
		let message = `${isAttendance ? '출근' : '퇴근'}하시겠습니까?`;
		let timeInterval;
		Swal.fire({
			icon: 'question',
			title: `${isAttendance ? '출근' : '퇴근'}하시겠습니까?`,
			html: `<span id="currentTime">${getDateTime(new Date)}</span>`,
			didOpen: () => {
				// 1초마다 시간 업데이트
				timeInterval = setInterval(() => {
					$('#currentTime').text(getDateTime(new Date));
				}, 1000);
			},
			showCancelButton: true,
			confirmButtonColor: '#0d6efd',
			cancelButtonColor: '#6c757d',
			confirmButtonText: '확인',
			cancelButtonText: '취소',
			reverseButtons: true, 
		}).then(result => {
			clearInterval(timeInterval);
			if (result.isConfirmed) { 
				$.ajax({
					type: 'post',
					url: '/insert_COMMUTE',
					contentType: 'application/json',
					data: JSON.stringify({attendance : isAttendance}),
					beforeSend : function(xhr) {
					    xhr.setRequestHeader(header, token);
					},
					success: function(data) {
						showToast('', 'success', '', data['msg']);
						if(isAttendance) {
						    $('#btn_attendance').prop('disabled', true);
						    $('#btn_leave_work').prop('disabled', false);
						} else {
						    $('#btn_leave_work').prop('disabled', true);
						}
					},
					error : function(xhr, textStatus, errorThrown) {
						let data = xhr.responseJSON;
						showAlert('', 'error', '', data['msg']);
					}
				});
			}
		});
	});
	
</script>

</html>